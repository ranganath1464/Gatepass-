<!-- templates/setup_fingerprint.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Fingerprint Setup</title>
</head>
<body>
    <h2>Fingerprint Setup</h2>
    <p>This device will be linked to your fingerprint for future logins.</p>

    <button onclick="registerFingerprint()">Setup Fingerprint</button>

    <script>
        async function registerFingerprint() {
            try {
                // Get challenge and credential options from server
                const res = await fetch("/generate-challenge");
                const options = await res.json();

                // Decode base64 challenge and credential ID
                options.challenge = Uint8Array.from(atob(options.challenge), c => c.charCodeAt(0));
                options.allowCredentials = options.allowCredentials.map(cred => ({
                    id: Uint8Array.from(atob(cred.id), c => c.charCodeAt(0)),
                    type: cred.type
                }));

                // Prompt fingerprint scan
                const credential = await navigator.credentials.get({
                    publicKey: options
                });

                if (credential) {
                    alert("✅ Fingerprint setup complete!");
                    // Redirect to dashboard (or save credential on server if needed)
                    window.location.href = "/student/dashboard";
                } else {
                    alert("❌ Fingerprint setup cancelled.");
                }
            } catch (err) {
                console.error("Fingerprint setup failed:", err);
                alert("❌ Failed to setup fingerprint: " + err.message);
            }
        }
    </script>
</body>
</html>
